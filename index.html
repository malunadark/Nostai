<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>NOSTAI ‚Äî –º–∞–≥–∏—á–µ—Å–∫–∞—è —Å—Ü–µ–Ω–∞</title>
<style>
body { margin: 0; overflow: hidden; font-family: sans-serif; }
#scene-container { width: 100vw; height: 100vh; display: block; position: relative; z-index: 1; }

/* –õ–æ–≥–æ—Ç–∏–ø */
#logo {
    position: absolute;
    top: 10%;
    left: 50%;
    transform: translateX(-50%);
    width: 400px;
    pointer-events: none;
    opacity: 0;
    animation: fadeIn 2s forwards 1s;
}
@keyframes fadeIn { to { opacity: 1; } }

/* –í–∏–¥–µ–æ-—Ä—É–Ω—ã */
#runes {
    position: absolute;
    top:0; left:0;
    width:100%; height:100%;
    object-fit:cover;
    pointer-events:none;
    mix-blend-mode: screen;
}

/* –§–æ–Ω –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
#bg {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background: url('assets/images/Nostai.png') no-repeat center center;
    background-size: cover;
    z-index: -1;
}
</style>
<link rel="icon" href="assets/images/favicon.png">
</head>
<body>

<div id="scene-container"></div>
<div id="bg"></div>
<img id="logo" src="assets/images/Nostai.png" alt="NOSTAI">
<video id="runes" autoplay muted loop playsinline>
    <source src="assets/video/rune2.webm" type="video/webm">
</video>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.156.0/build/three.module.js';
import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.156.0/examples/jsm/loaders/GLTFLoader.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.156.0/examples/jsm/controls/OrbitControls.js';

// ===== 1Ô∏è‚É£ –°—Ü–µ–Ω–∞, –∫–∞–º–µ—Ä–∞, —Ä–µ–Ω–¥–µ—Ä =====
const container = document.getElementById('scene-container');
const scene = new THREE.Scene();

// –§–æ–Ω —á–µ—Ä–µ–∑ —Å—Ü–µ–Ω—É (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ div –Ω–µ –≤–∏–¥–µ–Ω)
const loaderTexture = new THREE.TextureLoader();
loaderTexture.load('assets/images/Nostai.png', (texture)=>{
    scene.background = texture;
});

const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,2,5);

const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
renderer.setSize(window.innerWidth, window.innerHeight);
container.appendChild(renderer.domElement);

// ===== 2Ô∏è‚É£ –ö–æ–Ω—Ç—Ä–æ–ª—ã =====
const controls = new OrbitControls(camera, renderer.domElement);
controls.target.set(0,1,0);
controls.update();

// ===== 3Ô∏è‚É£ –°–≤–µ—Ç =====
scene.add(new THREE.AmbientLight(0xffffff,0.6));
const directionalLight = new THREE.DirectionalLight(0xffffff,1);
directionalLight.position.set(5,10,5);
scene.add(directionalLight);
const pointLight = new THREE.PointLight(0xffffff,0.8);
pointLight.position.set(2,3,2);
scene.add(pointLight);

// ===== 4Ô∏è‚É£ –î–≤–µ—Ä—å =====
let door;
const loader = new GLTFLoader();
loader.load('assets/models/door_optimized.glb',
    (gltf) => {
        door = gltf.scene;
        door.position.set(0,0,-1.5);
        door.scale.set(3,3,3);

        // –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å, –¥–µ–ª–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª –≤–∏–¥–∏–º—ã–º
        door.traverse((child)=>{
            if(child.isMesh) child.material.transparent = false;
        });

        scene.add(door);

        // üî¥ BoxHelper –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        const box = new THREE.BoxHelper(door, 0xff0000);
        scene.add(box);

        console.log("–î–≤–µ—Ä—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞");
    },
    xhr => console.log((xhr.loaded / xhr.total * 100) + '% –∑–∞–≥—Ä—É–∂–µ–Ω–æ'),
    error => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏:', error)
);

// ===== 5Ô∏è‚É£ –ê–Ω–∏–º–∞—Ü–∏—è –¥–≤–µ—Ä–∏ =====
function openDoor(){
    if(!door) return;
    const openAngle=Math.PI/2, duration=1.5;
    let startTime=performance.now();
    function animateDoor(time){
        const elapsed=(time-startTime)/1000;
        if(elapsed<duration){
            door.rotation.y=openAngle*(elapsed/duration);
            requestAnimationFrame(animateDoor);
        } else door.rotation.y=openAngle;
    }
    requestAnimationFrame(animateDoor);
}
document.addEventListener('click',()=>{openDoor();});

// ===== 6Ô∏è‚É£ –ß–∞—Å—Ç–∏—Ü—ã (—Ä—É–Ω—ã) =====
const particleCount = 150;
const geometry = new THREE.BufferGeometry();
const positions = [];
const velocities = [];
const colors = [];

for(let i=0;i<particleCount;i++){
    positions.push(
        (Math.random()-0.5)*8,
        Math.random()*4,
        (Math.random()-0.5)*6
    );
    velocities.push(
        (Math.random()-0.5)*0.03,
        Math.random()*0.02+0.005,
        (Math.random()-0.5)*0.03
    );
    colors.push(1,0.8,0.5);
}
geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions,3));
geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors,3));

const material = new THREE.PointsMaterial({size:0.07, vertexColors:true, transparent:true, opacity:0.7});
const particles = new THREE.Points(geometry, material);
scene.add(particles);

function animateParticles(){
    const pos = particles.geometry.attributes.position.array;
    for(let i=0;i<pos.length;i+=3){
        pos[i]+=velocities[i];     // x
        pos[i+1]+=velocities[i+1]; // y
        pos[i+2]+=velocities[i+2]; // z

        // –ó–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ
        if(pos[i+1]>4) pos[i+1]=0;
        if(pos[i]>4) pos[i]=-4;
        if(pos[i]<-4) pos[i]=4;
        if(pos[i+2]>3) pos[i+2]=-3;
        if(pos[i+2]<-3) pos[i+2]=3;
    }
    particles.geometry.attributes.position.needsUpdate=true;
}

// ===== 7Ô∏è‚É£ –†–µ–Ω–¥–µ—Ä =====
function animate(){
    requestAnimationFrame(animate);
    animateParticles();
    renderer.render(scene,camera);
}
animate();

// ===== 8Ô∏è‚É£ Resize =====
window.addEventListener('resize',()=>{
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
