<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>NOSTAI</title>
<style>
@font-face {
    font-family: 'DestroyCyr';
    src: url('assets/fonts/destroycyr.ttf') format('truetype');
}

body { margin: 0; overflow: hidden; font-family: sans-serif; }
#scene-container { width: 100vw; height: 100vh; display: block; position: relative; z-index: 1; }

/* Логотип текстом */
#logo {
    position: absolute;
    top: 5%;
    left: 50%;
    transform: translateX(-50%);
    font-family: 'DestroyCyr', sans-serif;
    font-size: 80px;
    color: #ffffff;
    text-shadow: 0 0 20px rgba(255,255,255,0.8);
    opacity: 0;
    animation: fadeIn 2s forwards 1s;
    pointer-events: none;
}
@keyframes fadeIn { to { opacity: 1; } }

/* Надпись на двери */
#door-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%,-50%);
    font-family: 'DestroyCyr', sans-serif;
    font-size: 36px;
    color: #ffffff;
    text-shadow: 0 0 15px rgba(255,255,255,0.8);
    pointer-events: none;
}

/* Видео-руны */
#runes {
    position: absolute;
    top:0; left:0;
    width:100%; height:100%;
    object-fit:cover;
    pointer-events:none;
    mix-blend-mode: screen;
}

/* Фон на весь экран */
body::before {
    content: "";
    position: absolute;
    top:0; left:0;
    width:100%; height:100%;
    background: url('assets/images/Nostai.png') no-repeat center center;
    background-size: cover;
    z-index: -2;
}
</style>
<link rel="icon" href="assets/images/favicon.png">
</head>
<body>

<div id="scene-container"></div>
<div id="logo">NOSTAI</div>
<div id="door-text">Хроники Забвения</div>
<video id="runes" autoplay muted loop playsinline>
    <source src="assets/video/rune2.webm" type="video/webm">
</video>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.156.0/build/three.module.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.156.0/examples/jsm/controls/OrbitControls.js';

// ===== Сцена, камера, рендер =====
const container = document.getElementById('scene-container');
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,2,6);

const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
renderer.setSize(window.innerWidth, window.innerHeight);
container.appendChild(renderer.domElement);

// Контролы
const controls = new OrbitControls(camera, renderer.domElement);
controls.target.set(0,1,0);
controls.update();

// Свет
scene.add(new THREE.AmbientLight(0xffffff,0.6));
const directionalLight = new THREE.DirectionalLight(0xffffff,1);
directionalLight.position.set(5,10,5);
scene.add(directionalLight);
const pointLight = new THREE.PointLight(0xffffff,0.8);
pointLight.position.set(2,3,2);
scene.add(pointLight);

// ===== Прозрачная дверь (Plane) =====
const doorMaterial = new THREE.MeshStandardMaterial({
    color: 0xffffff,
    transparent: true,
    opacity: 0.05,
    side: THREE.DoubleSide
});
const doorGeometry = new THREE.PlaneGeometry(2, 3);
const door = new THREE.Mesh(doorGeometry, doorMaterial);
door.position.set(0, 1.5, 0);
scene.add(door);

// BoxHelper для отладки (можно убрать)
const box = new THREE.BoxHelper(door, 0xff0000);
scene.add(box);

// ===== Частицы (руны) =====
const particleCount = 150;
const geometry = new THREE.BufferGeometry();
const positions = [];
const velocities = [];
const colors = [];

for(let i=0;i<particleCount;i++){
    positions.push((Math.random()-0.5)*8, Math.random()*4, (Math.random()-0.5)*6);
    velocities.push((Math.random()-0.5)*0.03, Math.random()*0.02+0.005, (Math.random()-0.5)*0.03);
    colors.push(1,0.8,0.5);
}
geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions,3));
geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors,3));

const particleMaterial = new THREE.PointsMaterial({
    size:0.07, vertexColors:true, transparent:true, opacity:0.8, blending:THREE.AdditiveBlending
});
const particles = new THREE.Points(geometry,particleMaterial);
scene.add(particles);

function animateParticles(){
    const pos = particles.geometry.attributes.position.array;
    for(let i=0;i<pos.length;i+=3){
        pos[i]+=velocities[i]; pos[i+1]+=velocities[i+1]; pos[i+2]+=velocities[i+2];
        if(pos[i+1]>4) pos[i+1]=0;
        if(pos[i]>4) pos[i]=-4;
        if(pos[i]<-4) pos[i]=4;
        if(pos[i+2]>3) pos[i+2]=-3;
        if(pos[i+2]<-3) pos[i+2]=3;
    }
    particles.geometry.attributes.position.needsUpdate=true;
}

// ===== Анимация двери и переход =====
function openDoorAnimation() {
    const duration = 1500;
    const start = performance.now();
    function animateDoor(time){
        const t = Math.min((time-start)/duration,1);
        door.rotation.y = t * Math.PI/2;
        camera.position.z = 6 - t*4;
        camera.position.x = 0;
        camera.position.y = 2 - t*0.5;
        if(t<1) requestAnimationFrame(animateDoor);
        else window.location.href = "nextpage.html";
    }
    requestAnimationFrame(animateDoor);
}
document.addEventListener('click', ()=>openDoorAnimation());

// ===== Рендер =====
function animate(){
    requestAnimationFrame(animate);
    animateParticles();
    renderer.render(scene,camera);
}
animate();

// ===== Resize =====
window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
