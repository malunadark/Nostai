<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>NOSTAI — Дверь</title>
    <style>
        /* Контейнер сцены занимает весь экран */
        body { margin: 0; overflow: hidden; }
        #scene-container { width: 100vw; height: 100vh; display: block; }
    </style>

    <!-- 1️⃣ Подключение Three.js и загрузчика GLTF -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.156.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.156.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.156.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

<!-- 2️⃣ Контейнер для 3D-сцены -->
<div id="scene-container"></div>

<script>
    // ==============================
    // 3️⃣ Создание сцены, камеры и рендерера
    // ==============================
    const container = document.getElementById('scene-container');

    // Сцена
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000000); // чёрный фон

    // Камера (45° поле зрения, под уровень глаз)
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 1.6, 3); // x, y, z

    // Рендерер
    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    container.appendChild(renderer.domElement);

    // ==============================
    // 4️⃣ Контролы для вращения сцены (не обязательно, но удобно для проверки)
    // ==============================
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.target.set(0,1,0); // куда смотреть
    controls.update();

    // ==============================
    // 5️⃣ Освещение сцены
    // ==============================
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5); // мягкий свет
    scene.add(ambientLight);

    const directionalLight = new THREE.DirectionalLight(0xffffff, 1); // основной свет
    directionalLight.position.set(5, 10, 5); // сверху и сбоку
    scene.add(directionalLight);

    // ==============================
    // 6️⃣ Загрузка двери (GLB)
    // ==============================
    const loader = new THREE.GLTFLoader();
    let door; // переменная для модели двери

    loader.load('assets/models/door_optimized.glb', function(gltf) {
        door = gltf.scene;               // получаем объект сцены из GLB
        door.position.set(0, 0, 0);      // ставим на землю
        scene.add(door);                  // добавляем в сцену
    }, undefined, function(error) {
        console.error(error);             // если ошибка при загрузке
    });

    // ==============================
    // 7️⃣ Функция открытия двери
    // ==============================
    function openDoor() {
        if (!door) return;

        const openAngle = Math.PI / 2; // 90° поворот по оси Y
        const duration = 1.5;          // время открытия в секундах

        let startTime = performance.now();
        function animateDoor(time) {
            const elapsed = (time - startTime) / 1000;
            if (elapsed < duration) {
                door.rotation.y = openAngle * (elapsed / duration);
                requestAnimationFrame(animateDoor);
            } else {
                door.rotation.y = openAngle;
            }
        }
        requestAnimationFrame(animateDoor);
    }

    // Клик по странице → открыть дверь
    document.addEventListener('click', () => {
        openDoor();
    });

    // ==============================
    // 8️⃣ Основной цикл рендера
    // ==============================
    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }
    animate();

    // ==============================
    // 9️⃣ Адаптация под размер окна
    // ==============================
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

</script>
</body>
</html>
