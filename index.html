<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NOSTAI</title>
<style>
/* ---- Шрифты ---- */
@font-face {
  font-family: 'destroycyr';
  src: url('assets/fonts/destroycyr.ttf') format('truetype');
  font-display: swap;
}
@font-face {
  font-family: 'futhark';
  src: url('assets/fonts/FutharkAoe.ttf') format('truetype');
  font-display: swap;
}

/* ---- Базовый стиль ---- */
:root{
  --gold:#ffb84d;
  --ember:#ff8c00;
  --bg-dark:#060405;
}
html,body{height:100%;margin:0;padding:0;background:#000;overflow:hidden;font-family:'destroycyr',sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
body{
  background: url('assets/images/Nostai.png') center/cover no-repeat fixed;
  position:relative;
  color:#d6d6d6;
}

/* ---- затемнение поверх фона для контраста ---- */
#overlay-bg{
  position:fixed;inset:0;background:rgba(0,0,0,0.45);pointer-events:none;z-index:1;
}

/* ---- логотип (гранитный, тёмный + огонь) ---- */
#logo{
  position:absolute;top:6vh;left:50%;transform:translateX(-50%);
  z-index:10;
  font-family:'destroycyr',serif;
  font-size:clamp(2.2rem,6vw,5.2rem);
  letter-spacing:6px;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-align:center;
  /* fallback если background-clip не поддерживается */
  color: #d0a36a;
  text-shadow:
    0 4px 6px rgba(0,0,0,0.9),
    0 0 14px rgba(255,90,0,0.6);
  animation:logoPulse 4s ease-in-out infinite;
}
/* текстура гранита — псевдоэлемент */
#logo::before{
  content:'';
  position:absolute;inset:0;
  background: url('assets/images/granite-noise.png') center/cover no-repeat;
  opacity:0.22;
  mix-blend-mode:overlay;
  z-index:-1;
  pointer-events:none;
}
@keyframes logoPulse{
  0%,100%{ filter:brightness(0.9); transform:translateX(-50%) scale(1); text-shadow:0 4px 6px rgba(0,0,0,0.9),0 0 12px rgba(255,80,0,0.5); }
  50%{ filter:brightness(1.05); transform:translateX(-50%) scale(1.03); text-shadow:0 6px 16px rgba(0,0,0,1),0 0 30px rgba(255,140,0,0.8); }
}

/* ---- подзаголовок ---- */
#subtitle{
  position:absolute;top:calc(6vh + 1.2em);left:50%;transform:translateX(-50%);
  z-index:10;
  font-size:clamp(0.9rem,1.8vw,1.4rem);
  color:var(--gold);
  text-shadow:0 0 10px rgba(255,140,0,0.35);
  cursor:default;
}

/* ---- руны как текстовые элементы (шрифт futhark) ---- */
.rune{
  position:absolute;
  font-family:'futhark', serif;
  font-size: clamp(20px, 3.2vw, 48px);
  color: rgba(255,190,140,0.92);
  text-shadow:
    0 0 8px rgba(255,140,0,0.45),
    0 0 18px rgba(255,100,0,0.25);
  transform-origin:center;
  mix-blend-mode:screen;
  z-index:6;
  opacity:0.95;
  pointer-events:none;
  animation: runeFlicker 3s ease-in-out infinite;
  will-change: transform, opacity;
}
/* мерцание / имитация тления */
@keyframes runeFlicker{
  0%{ transform:scale(1) rotate(0deg); opacity:0.92; filter:brightness(0.95); }
  45%{ transform:scale(1.06) rotate(-1deg); opacity:1; filter:brightness(1.15); }
  100%{ transform:scale(1) rotate(0deg); opacity:0.92; filter:brightness(0.95); }
}

/* ---- дополнительный декоративный слой runes image (низкая непрозрачность) ---- */
#runes-bg{
  position: absolute; right: 5%; top: 10%; width: 15vw; max-width:150px; opacity:0.08; z-index:5; pointer-events:none;
  mix-blend-mode:overlay;
}

/* ---- книга внизу, аккуратно на пол экрана (полуширина) ---- */
#bookWrap{ position:absolute; bottom:28px; left:50%; transform:translateX(-50%); z-index:8; text-align:center; width:50%; max-width:520px; }
#book{
  width:100%;
  height:auto;
  opacity:0.65;
  border-radius:8px;
  box-shadow:0 8px 30px rgba(0,0,0,0.6);
  transition: transform .5s ease, opacity .4s ease;
  cursor:pointer;
  display:block;
  margin:0 auto;
}
#book:hover{ transform: translateY(-8px) scale(1.03); opacity:1; }

/* свет и дым под книгой */
#bookGlow{ position:absolute; bottom:-36px; left:50%; transform:translateX(-50%); width:320px; height:130px; border-radius:50%; background:radial-gradient(circle, rgba(255,200,60,0.6) 0%, rgba(255,100,0,0) 70%); pointer-events:none; opacity:0; transition:opacity .35s ease; z-index:7; }
.glow-active{ opacity:1; }
#bookSmoke{ position:absolute; bottom:-6px; left:50%; transform:translateX(-50%); width:240px; height:120px; background:url('assets/images/smoke-fog.gif') center/contain no-repeat; opacity:0.55; pointer-events:none; z-index:7; }

/* ---- пепел canvas ---- */
#ashCanvas{ position:fixed; inset:0; z-index:9; pointer-events:none; }

/* ---- радио / переходы ---- */
#radioWrap{ position: fixed; left:14px; bottom:14px; z-index:12; cursor:pointer; }
canvas#radioScreen{ width:120px; height:60px; display:block; background:rgba(0,0,0,0.35); border-radius:6px; }

/* ---- кнопка/tap overlay для авто-запуска звука (если браузер блокирует) ---- */
#playOverlay{
  position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:40; pointer-events:auto;
  background:linear-gradient(rgba(0,0,0,0.55), rgba(0,0,0,0.65));
}
#playButton{
  background:linear-gradient(180deg, #ffb84d, #ff7a00); border:none; color:#111; padding:18px 26px; font-size:1.15rem; border-radius:12px; cursor:pointer;
  box-shadow:0 8px 30px rgba(0,0,0,0.5); font-family:'destroycyr',sans-serif;
}

/* ---- кросс-платформенность: fallbackы ---- */
@supports not (-webkit-background-clip: text){
  #logo{ -webkit-text-fill-color: initial; color:#c58a3a; }
}
/* вендорные префиксы (для старых движков) */
*{ -webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none; -webkit-tap-highlight-color:transparent; }

/* адаптив: на мобильных уменьшаем книгу и логотип */
@media (max-width:600px){
  #bookWrap{ width:70%; max-width:360px; bottom:18px; }
  #logo{ font-size:clamp(1.6rem,8vw,3rem); top:4vh; }
  .rune{ font-size: clamp(16px, 6vw, 34px); }
}
</style>
</head>
<body>

<!-- затемняющий слой -->
<div id="overlay-bg" aria-hidden="true"></div>

<!-- логотип -->
<div id="logo" aria-hidden="true">NOSTAI</div>
<div id="subtitle" aria-hidden="true">Придшие не уходят — те, кто здесь и там</div>

<!-- декоративная картинка рун (маленькая, низкая непрозрачность) -->
<img id="runes-bg" src="assets/images/руны.png" alt="" aria-hidden="true">

<!-- руны как текстовые метки (расположены "на деревьях") -->
<!-- ты можешь менять символы под свой шрифт FutharkAoe (буквы/символы рун) -->
<div class="rune" style="left:6%; top:20%; transform:translate(-50%,-50%);">ᚠ</div>
<div class="rune" style="left:12%; top:32%; transform:translate(-50%,-50%); font-size:42px;">ᚢ</div>
<div class="rune" style="left:18%; top:18%; transform:translate(-50%,-50%);">ᚦ</div>

<div class="rune" style="left:82%; top:22%; transform:translate(-50%,-50%);">ᚱ</div>
<div class="rune" style="left:76%; top:34%; transform:translate(-50%,-50%);">ᚲ</div>

<!-- книга -->
<div id="bookWrap">
  <img id="book" src="assets/images/old-notebook.png" alt="Хроники Забвения" title="Хроники Забвения">
  <div id="bookGlow" aria-hidden="true"></div>
  <div id="bookSmoke" aria-hidden="true"></div>
  <!-- под книгой добавим две ссылки для перехода (Хроники и Узел) -->
  <div style="margin-top:12px; display:flex; gap:12px; justify-content:center;">
    <button class="navBtn" data-href="html/chronicles.html" style="background:transparent;border:1px solid rgba(255,140,0,0.25);color:var(--gold);padding:8px 12px;border-radius:8px;cursor:pointer;">Хроники Забвения</button>
    <button class="navBtn" data-href="html/broadcast.html" style="background:transparent;border:1px solid rgba(255,140,0,0.25);color:var(--gold);padding:8px 12px;border-radius:8px;cursor:pointer;">Узел Связи</button>
  </div>
</div>

<!-- радиоприёмник (canvas-анимация) -->
<div id="radioWrap" title="Узел Связи" role="link" aria-label="Узел Связи">
  <canvas id="radioScreen" width="140" height="80"></canvas>
</div>

<!-- canvas для пепла -->
<canvas id="ashCanvas" aria-hidden="true"></canvas>

<!-- аудио (пути от корня) -->
<audio id="bg-music" src="assets/music/Уходящая Судьба.mp3" loop preload="auto"></audio>
<audio id="bookSound" src="assets/music/book-page-turn-4_z1xaim4u.mp3" preload="auto"></audio>

<!-- overlay для автозапуска (появится только если плеер заблокирован) -->
<div id="playOverlay" style="display:none;">
  <button id="playButton">Включить музыку</button>
</div>

<script>
/* ------------------ Радио-анимация ------------------ */
(function(){
  const canvas = document.getElementById('radioScreen');
  const ctx = canvas.getContext('2d');
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const bars = 18;
    const gap = 2;
    const barWidth = (canvas.width - (bars-1)*gap)/bars;
    for(let i=0;i<bars;i++){
      const h = Math.random()*canvas.height*0.8;
      const x = i*(barWidth+gap);
      const g = ctx.createLinearGradient(0, canvas.height-h, 0, canvas.height);
      g.addColorStop(0,'#FFB84D'); g.addColorStop(1,'#FF8C00');
      ctx.fillStyle = g;
      ctx.fillRect(x, canvas.height-h, barWidth, h);
    }
    requestAnimationFrame(draw);
  }
  draw();
})();

/* ------------------ Пепел (canvas particles) ------------------ */
(function(){
  const canvas = document.getElementById('ashCanvas');
  const ctx = canvas.getContext('2d');
  let W = canvas.width = window.innerWidth;
  let H = canvas.height = window.innerHeight;
  const count = Math.round((W*H)/12000); // масштабируем по разрешению
  const parts = [];
  function rand(min,max){ return Math.random()*(max-min)+min; }
  for(let i=0;i<count;i++){
    parts.push({
      x: rand(0,W),
      y: rand(0,H),
      r: rand(0.6,3.2),
      a: rand(0.08,0.35),
      dx: rand(-0.25,0.25),
      dy: rand(0.15,0.9),
      rot: rand(0,Math.PI*2),
      drift: rand(-0.02,0.02)
    });
  }
  function draw(){
    ctx.clearRect(0,0,W,H);
    for(let p of parts){
      p.x += p.dx; p.y += p.dy; p.rot += p.drift;
      if(p.y > H + 10){ p.y = -10; p.x = rand(0,W); }
      if(p.x < -10) p.x = W+10; if(p.x > W+10) p.x = -10;
      ctx.save();
      ctx.translate(p.x,p.y);
      ctx.rotate(p.rot);
      ctx.globalAlpha = p.a;
      ctx.fillStyle = '#cfcfcf';
      ctx.beginPath();
      ctx.ellipse(0,0,p.r,p.r*0.6,0,0,Math.PI*2);
      ctx.fill();
      ctx.restore();
    }
    requestAnimationFrame(draw);
  }
  draw();
  window.addEventListener('resize', ()=>{ W=canvas.width=window.innerWidth; H=canvas.height=window.innerHeight; });
})();

/* ------------------ Руны (если хочешь менять символы) ------------------ */
/* Пример: если надо заменить текст рун - можно менять innerText у .rune элементов */

/* ------------------ Кнопка и автозапуск музыки ------------------ */
(function(){
  const music = document.getElementById('bg-music');
  const playOverlay = document.getElementById('playOverlay');
  const playButton = document.getElementById('playButton');

  // Попытка автозапуска при заходе (некоторые браузеры позволяют если звук muted or user gestures)
  music.volume = 0.65;
  const tryAutoplay = music.play();
  if (tryAutoplay !== undefined) {
    tryAutoplay.then(()=> {
      // успешно запущено
      playOverlay.style.display = 'none';
    }).catch(()=> {
      // автозапуск заблокирован — покажем overlay
      playOverlay.style.display = 'flex';
    });
  }

  // при нажатии — запускаем музыку и скрываем overlay
  playButton.addEventListener('click', ()=> {
    music.play().catch(()=>{ /* игнорируем */ });
    playOverlay.style.display = 'none';
  });

  // чтобы любая первая интеракция также включала (на случай мобильных)
  window.addEventListener('pointerdown', function once(){ music.play().catch(()=>{}); window.removeEventListener('pointerdown', once); }, { once:true });
})();

/* ------------------ Книга: звук и переход ------------------ */
(function(){
  const book = document.getElementById('book');
  const bookSound = document.getElementById('bookSound');
  const glow = document.getElementById('bookGlow');
  const smoke = document.getElementById('bookSmoke');
  const navBtns = document.querySelectorAll('.navBtn');

  book.addEventListener('click', ()=> {
    // звук перелистывания
    bookSound.currentTime = 0;
    bookSound.play().catch(()=>{/* blocked */});
    // свет и дым
    glow.classList.add('glow-active');
    smoke.style.animation = 'smokeRise 1.2s ease forwards';
    setTimeout(()=> glow.classList.remove('glow-active'), 1000);
    // переход: через 1.1s переходим в хроники
    setTimeout(()=> { window.location.href = 'html/chronicles.html'; }, 1200);
  });

  navBtns.forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const href = btn.getAttribute('data-href');
      if(href) window.location.href = href;
    });
  });
})();

/* ------------------ навигация по радио-wrap ------------------ */
document.getElementById('radioWrap').addEventListener('click', ()=>{ window.location.href = 'html/broadcast.html'; });

/* ------------------ улучшение совместимости старых браузеров (не блокирующие) ---- */
/* маленькие полифиллы/фолбэки */
(function(){
  // requestAnimationFrame fallback
  if(!window.requestAnimationFrame){
    window.requestAnimationFrame = function(cb){ return setTimeout(cb,16); };
    window.cancelAnimationFrame = function(id){ clearTimeout(id); };
  }
})();
</script>
</body>
</html>
