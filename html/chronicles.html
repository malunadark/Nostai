<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Хроники Забвения</title>

<style>
@font-face {
  font-family: 'destroycyr';
  src: url('..assets/fonts/destroycyr.ttf') format('truetype');
  font-display: swap;
}

body {
  margin: 0;
  overflow: hidden;
  height: 100vh;
  font-family: 'destroycyr', serif;
  color: #f5f5f5;
  background: black;
  background-size: cover;
  background-position: center;
  transition: background 1s ease-in-out;
}

/* --- Логотип --- */
#logo {
  position: absolute;
  top: 8%;
  left: 50%;
  transform: translateX(-50%);
  font-size: 3.8vw;
  color: #ffcf7a;
  text-shadow: 0 0 20px #ff6600, 0 0 40px #b33, inset 2px 2px 4px #000;
  letter-spacing: 3px;
  font-weight: 700;
}

/* --- Книга --- */
#book {
  position: absolute;
  bottom: 12%;
  left: 50%;
  transform: translateX(-50%);
  width: 900px;
  max-width: 90%;
  background: url('..assets/images/book.png') center/contain no-repeat;
  height: 500px;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 60px 120px;
  box-sizing: border-box;
}

#text {
  font-size: 1.1rem;
  line-height: 1.6;
  color: #e8e8e8;
  text-align: justify;
  max-height: 100%;
  overflow: hidden;
  user-select: none;
}

/* --- Пепел --- */
#ashCanvas {
  position: fixed;
  top: 0;
  left: 0;
  pointer-events: none;
  width: 100%;
  height: 100%;
  z-index: 999;
}

/* --- Переход пепла --- */
.fade {
  animation: fadeInOut 3.5s ease-in-out forwards;
}
@keyframes fadeInOut {
  0% { opacity: 0; }
  25% { opacity: 1; }
  75% { opacity: 1; }
  100% { opacity: 0; }
}
</style>
</head>
<body>

<div id="logo">История Фракции Придшие</div>
<canvas id="ashCanvas"></canvas>

<div id="book">
  <div id="text"></div>
</div>

<audio id="pageSound" src="..assets/music/book-page-turn-4_z1xaim4u.mp3" preload="auto"></audio>

<script>
// --- Главы ---
const chapters = [
  {
    bg: '..assets/images/bg-volunteers.png',
    title: 'Волонтёры',
    text: `Они явились туда не первыми, но их миссия была самой важной — спасти от пожара людей.
В Алтайских лесах начались сильнейшие пожары, и даже силы ВС РФ, МЧС и Красного Креста едва справлялись.
Местные новости пустили срочный эфир — нужны люди. И люди пришли.

Волонтёры были разными: кто-то всю жизнь спасал других, кто-то просто не мог стоять в стороне.
Они действовали быстро, слаженно, рискуя собой. Их сила была не в оружии, а в смелости, терпении
и человечности. Каждый их поступок оставлял след в сердцах спасённых и в истории Алтайских лесов.`
  },
  {
    bg: '..assets/images/bg-military-base.png',
    title: 'ВС РФ',
    text: `Сила, мощь, дух — всё это заключено в слове ВС РФ.
Они пришли туда не просто выполнять долг, а чтобы показать границы возможного.
Где они идут — хаос отступает, а надежда становится осязаемой.

Они боролись с огнём, который не щадил никого.
Каждое их действие внушало уверенность: стихия подвластна тем,
кто не сдаётся даже перед лицом гибели.`
  },
  {
    bg: '..assets/images/bg-rescue-base.png',
    title: 'МЧС',
    text: `Сильные, доблестные — покорители огня.
Они рядом, когда рушится привычный мир. Они — щит, спасающий женщин, стариков и детей.
Когда в Алтайских лесах разгорелся пожар, МЧС сражались плечом к плечу с бойцами ВС РФ
и волонтёрами, помогая людям избежать трагедии.

Им чужды страх и сомнение — лишь долг и сострадание.`
  },
  {
    bg: '..assets/images/bg-redcross-camp.png',
    title: 'Красный Крест',
    text: `Они несли свет милосердия среди пепла.
Медики Красного Креста прибывали туда, где уже не было сил даже у спасателей.
Они перевязывали раны, выносили из огня пострадавших, возвращали к жизни тех,
в ком едва теплилось дыхание.

Они — сердце этой борьбы. Их символ — не просто крест, а клятва помогать до последнего вздоха.`
  }
];

let current = 0;
const textEl = document.getElementById('text');
const pageSound = document.getElementById('pageSound');
const ashCanvas = document.getElementById('ashCanvas');
const ctx = ashCanvas.getContext('2d');
let ashes = [];

function resizeCanvas() {
  ashCanvas.width = window.innerWidth;
  ashCanvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// --- Пепел частицы ---
function createAshes() {
  ashes = [];
  for (let i = 0; i < 80; i++) {
    ashes.push({
      x: Math.random() * ashCanvas.width,
      y: Math.random() * ashCanvas.height,
      size: 2 + Math.random() * 4,
      speed: 0.5 + Math.random() * 1.2,
      opacity: 0.3 + Math.random() * 0.3,
    });
  }
}
function drawAshes() {
  ctx.clearRect(0, 0, ashCanvas.width, ashCanvas.height);
  ctx.fillStyle = 'rgba(180,180,180,0.5)';
  ashes.forEach(a => {
    ctx.beginPath();
    ctx.arc(a.x, a.y, a.size, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(150,150,150,${a.opacity})`;
    ctx.fill();
    a.y += a.speed;
    if (a.y > ashCanvas.height) a.y = -10;
  });
  requestAnimationFrame(drawAshes);
}

// --- Загрузка главы ---
function loadChapter(index) {
  const chapter = chapters[index];
  document.body.style.backgroundImage = `url(${chapter.bg})`;
  textEl.innerHTML = `<h2 style="text-align:center">${chapter.title}</h2><p>${chapter.text.replace(/\n/g, '<br>')}</p>`;
}

// --- Переход пеплом ---
function ashTransition(next) {
  const fadeDiv = document.createElement('div');
  fadeDiv.className = 'fade';
  fadeDiv.style.position = 'fixed';
  fadeDiv.style.top = 0;
  fadeDiv.style.left = 0;
  fadeDiv.style.width = '100%';
  fadeDiv.style.height = '100%';
  fadeDiv.style.background = 'rgba(60,60,60,0.8)';
  fadeDiv.style.zIndex = 1000;
  document.body.appendChild(fadeDiv);

  pageSound.currentTime = 0;
  pageSound.play();

  setTimeout(() => {
    fadeDiv.remove();
    if (next < chapters.length) {
      loadChapter(next);
    } else {
      // Последняя — чёрный экран с дымом
      document.body.style.backgroundImage = "url('..assets/images/smoke-fog.gif')";
      textEl.innerHTML = '';
      document.getElementById('logo').textContent = '...';
    }
  }, 3000);
}

// --- Управление кликом ---
document.addEventListener('click', () => {
  current++;
  if (current <= chapters.length) {
    ashTransition(current);
  }
});

// --- Инициализация ---
createAshes();
drawAshes();
loadChapter(0);
</script>
</body>
</html>
