<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Хроники Забвения — NOSTAI</title>

<link rel="preload" href="../assets/fonts/destroycyr.ttf" as="font" type="font/ttf" crossorigin>

<style>
@font-face {
  font-family: 'destroycyr';
  src: url('../assets/fonts/destroycyr.ttf') format('truetype');
  font-display: swap;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  min-height: 100svh;
  font-family: 'destroycyr', serif;
  color: #eaeaea;
  background-color: #000;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  transition: background-image 1s ease;
  overflow: hidden;
}

/* ===== ЛОГО ===== */
#logo {
  position: fixed;
  top: 6svh;
  left: 50%;
  transform: translateX(-50%);
  font-size: clamp(2rem, 6vw, 4.5rem);
  color: #ffcf7a;
  text-shadow: 0 0 20px #ff6600, 0 0 40px #b33;
  z-index: 5;
  pointer-events: none;
}

/* ===== КНИГА ===== */
#book {
  position: fixed;
  bottom: 6svh;
  left: 50%;
  transform: translateX(-50%);
  width: min(92vw, 960px);
  height: min(62svh, 540px);
  padding: clamp(24px, 4vw, 64px) clamp(26px, 6vw, 96px);
  background: url('../assets/images/book.png') center/contain no-repeat;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 3;
}

/* ===== ТЕКСТ В КНИГЕ ===== */
#text {
  width: 100%;
  height: 100%;
  font-size: clamp(0.9rem, 2.2vw, 1.15rem);
  line-height: 1.6;
  color: #2b2b2b;
  text-align: justify;
  overflow: hidden;
  user-select: none;
}

#text h2 {
  text-align: center;
  margin-top: 0;
}

/* ===== ПЕПЕЛ ===== */
#ashCanvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 10;
}

/* ===== КНОПКА НАЗАД ===== */
#back {
  position: fixed;
  bottom: 3svh;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.9rem;
  opacity: 0.6;
  color: #fff;
  text-decoration: none;
  z-index: 20;
}
#back:hover { opacity: 1; }

/* ===== МОБИЛЬНАЯ АДАПТАЦИЯ ===== */
@media (max-width: 600px) {
  #book {
    height: 68svh;
    padding: 20px 26px;
  }
  #text {
    font-size: 0.85rem;
  }
}
</style>
</head>

<body>

<div id="logo">История Фракции</div>
<canvas id="ashCanvas"></canvas>

<div id="book">
  <div id="text"></div>
</div>

<a id="back" href="../index.html">← NOSTAI</a>

<audio id="pageSound" src="../assets/music/book-page-turn-4_z1xaim4u.mp3" preload="auto"></audio>

<script>
/* ===== ГЛАВЫ ===== */
const chapters = [
  {
    bg: '../assets/images/bg-volunteers.png',
    title: 'Волонтёры',
    text: `Они явились туда не первыми, но их миссия была самой важной — спасти людей...`
  },
  {
    bg: '../assets/images/bg-military-base.png',
    title: 'ВС РФ',
    text: `Сила, мощь, дух — всё это заключено в слове ВС РФ...`
  },
  {
    bg: '../assets/images/bg-rescue-base.png',
    title: 'МЧС',
    text: `Сильные, доблестные — покорители огня...`
  },
  {
    bg: '../assets/images/bg-redcross-camp.png',
    title: 'Красный Крест',
    text: `Они несли свет милосердия среди пепла...`
  }
];

let current = 0;
const textEl = document.getElementById('text');
const logo = document.getElementById('logo');
const pageSound = document.getElementById('pageSound');

/* ===== ЗАГРУЗКА ГЛАВЫ ===== */
function loadChapter(i) {
  const c = chapters[i];
  document.body.style.backgroundImage = `url('${c.bg}')`;
  logo.textContent = c.title;
  textEl.innerHTML = `<h2>${c.title}</h2><p>${c.text.replace(/\n/g,'<br>')}</p>`;
}

/* ===== ПЕРЕЛИСТЫВАНИЕ ===== */
document.addEventListener('click', () => {
  current++;
  if (current < chapters.length) {
    pageSound.currentTime = 0;
    pageSound.play();
    loadChapter(current);
  }
});

/* ===== ПЕПЕЛ (ОПТИМИЗИРОВАННЫЙ) ===== */
const canvas = document.getElementById('ashCanvas');
const ctx = canvas.getContext('2d');
let ash = [];

function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
window.addEventListener('resize', resize);
resize();

for (let i = 0; i < 60; i++) {
  ash.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    s: Math.random()*2+1,
    v: Math.random()*0.4+0.2
  });
}

function drawAsh() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = 'rgba(200,200,200,0.6)';
  ash.forEach(a=>{
    a.y -= a.v;
    if (a.y < 0) a.y = canvas.height;
    ctx.beginPath();
    ctx.arc(a.x,a.y,a.s,0,Math.PI*2);
    ctx.fill();
  });
  requestAnimationFrame(drawAsh);
}
drawAsh();

/* ===== ИНИТ ===== */
loadChapter(0);
</script>

</body>
</html>
